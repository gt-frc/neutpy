import numpy as np
from scipy.interpolate import Rbf


def _calc_svione_degas():
    """Calculates the electron impact ionization reactivity using the degas cross sections

    accepts ne in m^-3 and Te in keV
    returns value in m^3/s

    """
    # populate the 15x60 array to be used for interpolations
    # rows correspond to ne, columns correspond to Te

    svion_data = np.zeros((15, 60))
    svion_data[0] = np.array([1.00000E-99, 8.23273E-79, 2.71317E-67, 2.66585E-55, 8.79947E-46, 3.16283E-38,
                              3.15323E-32, 1.83420E-27, 1.12534E-23, 1.16683E-20, 2.97480E-18, 2.51111E-16,
                              8.57971E-15, 1.50074E-13, 1.51826E-12, 9.93555E-12, 4.58972E-11, 1.60312E-10,
                              4.46589E-10, 1.03558E-09, 2.06751E-09, 3.65749E-09, 5.84839E-09, 8.59216E-09,
                              1.17700E-08, 1.52155E-08, 1.87465E-08, 2.21895E-08, 2.53935E-08, 2.82342E-08,
                              3.06141E-08, 3.24630E-08, 3.37401E-08, 3.44364E-08, 3.45743E-08, 3.42046E-08,
                              3.33990E-08, 3.22410E-08, 3.08169E-08, 2.86297E-08, 2.66209E-08, 2.46946E-08,
                              2.28604E-08, 2.11240E-08, 1.94798E-08, 1.79424E-08, 1.65048E-08, 1.51644E-08,
                              1.39180E-08, 1.27614E-08, 1.16905E-08, 1.07006E-08, 9.78692E-09, 8.94489E-09,
                              8.16984E-09, 7.45728E-09, 6.80287E-09, 6.20244E-09, 5.65204E-09, 5.14793E-09])
    svion_data[1] = np.array([1.00000E-99, 4.82970E-82, 7.83240E-67, 5.09204E-55, 1.56205E-45, 5.27263E-38,
                              4.97672E-32, 2.75568E-27, 1.61419E-23, 1.59996E-20, 3.90124E-18, 3.15201E-16,
                              1.03886E-14, 1.75120E-13, 1.71526E-12, 1.09243E-11, 4.93698E-11, 1.69495E-10,
                              4.65965E-10, 1.06969E-09, 2.11967E-09, 3.73201E-09, 5.94854E-09, 8.71687E-09,
                              1.19171E-08, 1.53810E-08, 1.89261E-08, 2.23789E-08, 2.55887E-08, 2.84317E-08,
                              3.08110E-08, 3.26572E-08, 3.39298E-08, 3.46203E-08, 3.47515E-08, 3.43747E-08,
                              3.35615E-08, 3.23958E-08, 3.09640E-08, 2.87693E-08, 2.67529E-08, 2.48194E-08,
                              2.29782E-08, 2.12350E-08, 1.95784E-08, 1.80330E-08, 1.65876E-08, 1.52399E-08,
                              1.39865E-08, 1.28234E-08, 1.17464E-08, 1.07508E-08, 9.83189E-09, 8.98502E-09,
                              8.20554E-09, 7.48893E-09, 6.83083E-09, 6.22706E-09, 5.67365E-09, 5.16683E-09])
    svion_data[2] = np.array([1.00000E-99, 8.24318E-79, 1.32124E-66, 1.08123E-54, 3.03359E-45, 9.48783E-38,
                              8.38562E-32, 4.38472E-27, 2.43932E-23, 2.30382E-20, 5.36106E-18, 4.13704E-16,
                              1.31130E-14, 2.12229E-13, 2.00320E-12, 1.23534E-11, 5.43439E-11, 1.82547E-10,
                              4.93352E-10, 1.11776E-09, 2.19295E-09, 3.83702E-09, 6.08955E-09, 8.89201E-09,
                              1.21234E-08, 1.56123E-08, 1.91769E-08, 2.26428E-08, 2.58601E-08, 2.87057E-08,
                              3.10837E-08, 3.29253E-08, 3.41911E-08, 3.48730E-08, 3.49946E-08, 3.46074E-08,
                              3.37834E-08, 3.26069E-08, 3.11642E-08, 2.89589E-08, 2.69323E-08, 2.49888E-08,
                              2.31381E-08, 2.13857E-08, 1.97125E-08, 1.81563E-08, 1.67008E-08, 1.53434E-08,
                              1.40809E-08, 1.29094E-08, 1.18244E-08, 1.08215E-08, 9.89581E-09, 9.04268E-09,
                              8.25745E-09, 7.53556E-09, 6.87263E-09, 6.26445E-09, 5.70702E-09, 5.19654E-09])
    svion_data[3] = np.array([1.00000E-99, 3.72430E-81, 3.97672E-66, 2.61445E-54, 6.61570E-45, 1.88911E-37,
                              1.54136E-31, 7.52212E-27, 3.93990E-23, 3.52433E-20, 7.79589E-18, 5.72904E-16,
                              1.74058E-14, 2.69512E-13, 2.44040E-12, 1.44945E-11, 6.17139E-11, 2.01711E-10,
                              5.33260E-10, 1.18741E-09, 2.29863E-09, 3.98879E-09, 6.29280E-09, 9.14480E-09,
                              1.24213E-08, 1.59453E-08, 1.95377E-08, 2.30214E-08, 2.62489E-08, 2.90976E-08,
                              3.14730E-08, 3.33074E-08, 3.45627E-08, 3.52317E-08, 3.53388E-08, 3.49360E-08,
                              3.40961E-08, 3.29034E-08, 3.14449E-08, 2.92239E-08, 2.71822E-08, 2.52242E-08,
                              2.33596E-08, 2.15940E-08, 1.98971E-08, 1.83259E-08, 1.68559E-08, 1.54850E-08,
                              1.42099E-08, 1.30266E-08, 1.19308E-08, 1.09178E-08, 9.98290E-09, 9.12131E-09,
                              8.32834E-09, 7.59939E-09, 6.93004E-09, 6.31601E-09, 5.75328E-09, 5.23799E-09])
    svion_data[4] = np.array([1.61095E-99, 8.35428E-79, 1.12534E-65, 7.35596E-54, 1.66349E-44, 4.28461E-37,
                              3.17867E-31, 1.42606E-26, 6.94611E-23, 5.82950E-20, 1.21751E-17, 8.47951E-16,
                              2.45830E-14, 3.62783E-13, 3.13735E-12, 1.78504E-11, 7.31077E-11, 2.31009E-10,
                              5.93697E-10, 1.29204E-09, 2.45657E-09, 4.21556E-09, 6.59497E-09, 9.52031E-09,
                              1.28626E-08, 1.64393E-08, 2.00730E-08, 2.35814E-08, 2.68237E-08, 2.96761E-08,
                              3.20469E-08, 3.38696E-08, 3.51084E-08, 3.57575E-08, 3.58423E-08, 3.54158E-08,
                              3.45517E-08, 3.33345E-08, 3.18518E-08, 2.96073E-08, 2.75428E-08, 2.55630E-08,
                              2.36776E-08, 2.18918E-08, 2.01603E-08, 1.85667E-08, 1.70757E-08, 1.56850E-08,
                              1.43915E-08, 1.31911E-08, 1.20795E-08, 1.10521E-08, 1.01040E-08, 9.23029E-09,
                              8.42632E-09, 7.68739E-09, 7.00899E-09, 6.38678E-09, 5.81666E-09, 5.29471E-09])
    svion_data[5] = np.array([5.79413E-99, 4.32978E-80, 4.04173E-65, 2.46015E-53, 4.99802E-44, 1.15206E-36,
                              7.64481E-31, 3.08827E-26, 1.37501E-22, 1.06796E-19, 2.08389E-17, 1.36484E-15,
                              3.75124E-14, 5.25264E-13, 4.31955E-12, 2.34238E-11, 9.17108E-11, 2.78194E-10,
                              6.89925E-10, 1.45705E-09, 2.70478E-09, 4.57133E-09, 7.06605E-09, 1.01029E-08,
                              1.35441E-08, 1.72022E-08, 2.08979E-08, 2.44437E-08, 2.77081E-08, 3.05660E-08,
                              3.29296E-08, 3.47307E-08, 3.59426E-08, 3.65595E-08, 3.66085E-08, 3.61443E-08,
                              3.52416E-08, 3.39855E-08, 3.24646E-08, 3.01831E-08, 2.80829E-08, 2.60690E-08,
                              2.41511E-08, 2.23325E-08, 2.05493E-08, 1.89216E-08, 1.73985E-08, 1.59778E-08,
                              1.46565E-08, 1.34305E-08, 1.22953E-08, 1.12462E-08, 1.02784E-08, 9.38681E-09,
                              8.56659E-09, 7.81294E-09, 7.12125E-09, 6.48707E-09, 5.90617E-09, 5.37454E-09])
    svion_data[6] = np.array([1.87859E-98, 1.40828E-79, 1.73719E-64, 9.86529E-53, 1.83383E-43, 3.80019E-36,
                              2.24241E-30, 8.04056E-26, 3.22285E-22, 2.28138E-19, 4.09736E-17, 2.49005E-15,
                              6.41230E-14, 8.45699E-13, 6.57101E-12, 3.37408E-11, 1.25350E-10, 3.61885E-10,
                              8.57877E-10, 1.74116E-09, 3.13144E-09, 5.17959E-09, 7.86421E-09, 1.10816E-08,
                              1.46801E-08, 1.84662E-08, 2.22562E-08, 2.58620E-08, 2.91585E-08, 3.20232E-08,
                              3.43737E-08, 3.61292E-08, 3.72930E-08, 3.78538E-08, 3.78414E-08, 3.73118E-08,
                              3.63438E-08, 3.50210E-08, 3.34358E-08, 3.10922E-08, 2.89327E-08, 2.68622E-08,
                              2.48908E-08, 2.30114E-08, 2.11508E-08, 1.94683E-08, 1.78938E-08, 1.64255E-08,
                              1.50601E-08, 1.37936E-08, 1.26214E-08, 1.15386E-08, 1.05401E-08, 9.62076E-09,
                              8.77547E-09, 7.99924E-09, 7.28723E-09, 6.63481E-09, 6.03757E-09, 5.49131E-09])
    svion_data[7] = np.array([4.76247E-98, 3.65341E-79, 8.32708E-64, 4.58586E-52, 8.07957E-43, 1.55101E-35,
                              8.29936E-30, 2.65754E-25, 9.50276E-22, 6.01804E-19, 9.72796E-17, 5.36604E-15,
                              1.27001E-13, 1.56219E-12, 1.13825E-11, 5.49938E-11, 1.92597E-10, 5.25151E-10,
                              1.17907E-09, 2.27577E-09, 3.93717E-09, 6.31833E-09, 9.34496E-09, 1.28826E-08,
                              1.67565E-08, 2.07620E-08, 2.47094E-08, 2.84152E-08, 3.17593E-08, 3.46284E-08,
                              3.69484E-08, 3.86217E-08, 3.96963E-08, 4.01536E-08, 4.00283E-08, 3.93679E-08,
                              3.82765E-08, 3.68250E-08, 3.51177E-08, 3.26571E-08, 3.03859E-08, 2.82097E-08,
                              2.61389E-08, 2.41295E-08, 2.21482E-08, 2.03684E-08, 1.87041E-08, 1.71530E-08,
                              1.57121E-08, 1.43768E-08, 1.31422E-08, 1.20031E-08, 1.09538E-08, 9.98875E-09,
                              9.10248E-09, 8.28954E-09, 7.54472E-09, 6.86300E-09, 6.23963E-09, 5.67011E-09])
    svion_data[8] = np.array([1.00000E-99, 5.61821E-78, 3.83436E-63, 2.11526E-51, 3.67921E-42, 6.81104E-35,
                              3.41408E-29, 9.98793E-25, 3.21535E-21, 1.82402E-18, 2.64770E-16, 1.32016E-14,
                              2.85639E-13, 3.27481E-12, 2.23582E-11, 1.01543E-10, 3.34763E-10, 8.59961E-10,
                              1.82096E-09, 3.32143E-09, 5.51275E-09, 8.51515E-09, 1.21694E-08, 1.62870E-08,
                              2.06542E-08, 2.50466E-08, 2.92679E-08, 3.31435E-08, 3.65625E-08, 3.94290E-08,
                              4.16845E-08, 4.32367E-08, 4.41594E-08, 4.44400E-08, 4.41218E-08, 4.32027E-08,
                              4.18850E-08, 4.01906E-08, 3.82539E-08, 3.55724E-08, 3.30892E-08, 3.07113E-08,
                              2.84498E-08, 2.61614E-08, 2.39701E-08, 2.20041E-08, 2.01677E-08, 1.84590E-08,
                              1.68743E-08, 1.54087E-08, 1.40567E-08, 1.28121E-08, 1.16684E-08, 1.06192E-08,
                              9.65804E-09, 8.77868E-09, 7.97504E-09, 7.24135E-09, 6.57213E-09, 5.96219E-09])
    svion_data[9] = np.array([1.14633E-97, 1.73862E-77, 1.44527E-62, 8.11467E-51, 1.42552E-41, 2.61941E-34,
                              1.27174E-28, 3.52827E-24, 1.06201E-20, 5.59217E-18, 7.50647E-16, 3.45384E-14,
                              6.90757E-13, 7.38136E-12, 4.70531E-11, 2.00060E-10, 6.19325E-10, 1.49840E-09,
                              2.99645E-09, 5.17518E-09, 8.25817E-09, 1.22735E-08, 1.69404E-08, 2.19923E-08,
                              2.71602E-08, 3.21915E-08, 3.68805E-08, 4.10643E-08, 4.46444E-08, 4.75492E-08,
                              4.97420E-08, 5.11611E-08, 5.18855E-08, 5.19235E-08, 5.13318E-08, 5.00178E-08,
                              4.83521E-08, 4.62746E-08, 4.39673E-08, 4.09210E-08, 3.80806E-08, 3.53564E-08,
                              3.27619E-08, 2.99359E-08, 2.73761E-08, 2.50684E-08, 2.29138E-08, 2.09113E-08,
                              1.90573E-08, 1.73466E-08, 1.57725E-08, 1.43276E-08, 1.30043E-08, 1.17944E-08,
                              1.06902E-08, 9.68365E-09, 8.76739E-09, 7.93419E-09, 7.17724E-09, 6.49014E-09])
    svion_data[10] = np.array([6.62317E-93, 5.28961E-77, 4.27658E-62, 2.45697E-50, 4.39889E-41, 8.16171E-34,
                               3.94672E-28, 1.07648E-23, 3.14271E-20, 1.57904E-17, 1.98519E-15, 8.42615E-14,
                               1.54413E-12, 1.50839E-11, 8.83838E-11, 3.48677E-10, 1.01215E-09, 2.31817E-09,
                               4.42230E-09, 7.32915E-09, 1.13559E-08, 1.64255E-08, 2.21454E-08, 2.81825E-08,
                               3.42211E-08, 3.99837E-08, 4.52550E-08, 4.98787E-08, 5.37636E-08, 5.68549E-08,
                               5.91325E-08, 6.05690E-08, 6.12316E-08, 6.11518E-08, 6.03980E-08, 5.88607E-08,
                               5.69511E-08, 5.45952E-08, 5.19895E-08, 4.86271E-08, 4.54567E-08, 4.23923E-08,
                               3.94510E-08, 3.59069E-08, 3.28849E-08, 3.01241E-08, 2.75291E-08, 2.51038E-08,
                               2.28480E-08, 2.07590E-08, 1.88319E-08, 1.70601E-08, 1.54361E-08, 1.39516E-08,
                               1.25979E-08, 1.13661E-08, 1.02473E-08, 9.23290E-09, 8.31453E-09, 7.48414E-09])
    svion_data[11] = np.array([1.35178E-97, 1.11383E-76, 9.48789E-62, 5.60697E-50, 1.03378E-40, 1.96630E-33,
                               9.68188E-28, 2.66194E-23, 7.67512E-20, 3.67843E-17, 4.25046E-15, 1.62518E-13,
                               2.68430E-12, 2.37645E-11, 1.28540E-10, 4.76520E-10, 1.31939E-09, 2.91458E-09,
                               5.40551E-09, 8.75819E-09, 1.33570E-08, 1.90609E-08, 2.54164E-08, 3.20581E-08,
                               3.86475E-08, 4.48952E-08, 5.05800E-08, 5.55483E-08, 5.97106E-08, 6.30194E-08,
                               6.54607E-08, 6.70303E-08, 6.77783E-08, 6.77503E-08, 6.70197E-08, 6.55577E-08,
                               6.36554E-08, 6.13113E-08, 5.86882E-08, 5.52898E-08, 5.20668E-08, 4.89334E-08,
                               4.59066E-08, 4.18891E-08, 3.86203E-08, 3.55932E-08, 3.27162E-08, 2.99976E-08,
                               2.74413E-08, 2.50485E-08, 2.28178E-08, 2.07458E-08, 1.88279E-08, 1.70582E-08,
                               1.54302E-08, 1.39367E-08, 1.25703E-08, 1.13232E-08, 1.01878E-08, 9.15631E-09])
    svion_data[12] = np.array([1.38886E-97, 1.72309E-76, 1.51393E-61, 9.17508E-50, 1.73972E-40, 3.41627E-33,
                               1.73068E-27, 4.85262E-23, 1.39073E-19, 6.32804E-17, 6.68092E-15, 2.31948E-13,
                               3.53317E-12, 2.92803E-11, 1.51144E-10, 5.42325E-10, 1.46777E-09, 3.18987E-09,
                               5.84524E-09, 9.38334E-09, 1.42194E-08, 2.01856E-08, 2.68050E-08, 3.37000E-08,
                               4.05242E-08, 4.69837E-08, 5.28553E-08, 5.79866E-08, 6.22883E-08, 6.57156E-08,
                               6.82565E-08, 6.99171E-08, 7.07385E-08, 7.07719E-08, 7.00928E-08, 6.87396E-08,
                               6.69029E-08, 6.46425E-08, 6.20913E-08, 5.87614E-08, 5.56053E-08, 5.25366E-08,
                               4.95716E-08, 4.53956E-08, 4.20963E-08, 3.90253E-08, 3.60915E-08, 3.33040E-08,
                               3.06676E-08, 2.81842E-08, 2.58534E-08, 2.36728E-08, 2.16388E-08, 1.97464E-08,
                               1.79904E-08, 1.63646E-08, 1.48627E-08, 1.34783E-08, 1.22048E-08, 1.10356E-08])
    svion_data[13] = np.array([1.41725E-97, 2.04412E-76, 1.90737E-61, 1.15967E-49, 2.22502E-40, 4.43725E-33,
                               2.29912E-27, 6.54464E-23, 1.86941E-19, 8.19511E-17, 8.16294E-15, 2.68496E-13,
                               3.93032E-12, 3.16279E-11, 1.60150E-10, 5.67430E-10, 1.52259E-09, 3.28943E-09,
                               6.00195E-09, 9.60515E-09, 1.45243E-08, 2.05839E-08, 2.72967E-08, 3.42822E-08,
                               4.11893E-08, 4.77241E-08, 5.36627E-08, 5.88534E-08, 6.32068E-08, 6.66790E-08,
                               6.92589E-08, 7.09565E-08, 7.18090E-08, 7.18700E-08, 7.12157E-08, 6.99139E-08,
                               6.81115E-08, 6.58955E-08, 6.33856E-08, 6.00975E-08, 5.69850E-08, 5.39615E-08,
                               5.10434E-08, 4.68274E-08, 4.35414E-08, 4.04798E-08, 3.75518E-08, 3.47664E-08,
                               3.21286E-08, 2.96403E-08, 2.73011E-08, 2.51087E-08, 2.30594E-08, 2.11485E-08,
                               1.93705E-08, 1.77195E-08, 1.61893E-08, 1.47733E-08, 1.34652E-08, 1.22586E-08])
    svion_data[14] = np.array([1.72232E-97, 2.43222E-76, 2.03219E-61, 1.23882E-49, 2.50993E-40, 4.98024E-33,
                               2.57731E-27, 7.37279E-23, 2.10281E-19, 9.05148E-17, 8.78487E-15, 2.82727E-13,
                               4.07609E-12, 3.24564E-11, 1.63242E-10, 5.75830E-10, 1.54043E-09, 3.32149E-09,
                               6.05218E-09, 9.67522E-09, 1.46209E-08, 2.07114E-08, 2.74539E-08, 3.44679E-08,
                               4.14067E-08, 4.79679E-08, 5.39334E-08, 5.91455E-08, 6.35178E-08, 6.70040E-08,
                               6.95961E-08, 7.13052E-08, 7.21676E-08, 7.22375E-08, 7.15913E-08, 7.03073E-08,
                               6.85171E-08, 6.63171E-08, 6.38224E-08, 6.05500E-08, 5.74545E-08, 5.44489E-08,
                               5.15497E-08, 4.73231E-08, 4.40452E-08, 4.09908E-08, 3.80692E-08, 3.52893E-08,
                               3.26561E-08, 3.01718E-08, 2.78357E-08, 2.56458E-08, 2.35982E-08, 2.16882E-08,
                               1.99104E-08, 1.82589E-08, 1.67273E-08, 1.53092E-08, 1.39982E-08, 1.27877E-08])

    # data are given in  cm^3/s. Convert to m^3/s
    svion_data = svion_data * 1E-6

    Te_vals, ne_vals = np.meshgrid(-1.2 + (np.linspace(1, 60, 60) - 1) / 10 - 3,  # log10(T in kev)
                                   10 + 0.5 * (np.linspace(1, 15, 15) - 1) + 6)  # log10(n in m^-3)

    # perform 2D interpolation
    # sigv_ion_e = griddata(np.column_stack((Te_vals.flatten(), ne_vals.flatten())),
    #                      svion_data.flatten(),
    #                      (np.asarray(Te), np.asarray(ne)),
    #                      method='linear',
    #                      rescale=True)

    sigv_ion_e = Rbf(Te_vals, ne_vals, svion_data)

    return sigv_ion_e
